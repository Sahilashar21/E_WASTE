{% extends 'base.html' %}

{% block content %}
<div class="max-w-7xl mx-auto mt-8 fade-in-up">
  <div class="flex items-center justify-between mb-8">
    <h1 class="text-4xl font-bold text-[#005461]">Advanced Analytics Dashboard</h1>
    <a href="{{ url_for('warehouse.dashboard') }}" class="glass bg-white/50 text-gray-600 px-4 py-2 rounded-xl font-semibold hover:bg-white hover:text-[#005461] transition-all border border-white/50">â† Back to Dashboard</a>
  </div>

  <!-- Key Metrics Row -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8 fade-in-up" style="animation-delay: 100ms;">
    <div class="glass p-6 rounded-2xl shadow-sm border-l-4 border-blue-500 hover:-translate-y-1 transition-transform">
      <div class="text-sm font-bold text-gray-500 uppercase mb-2">Total Requests</div>
      <div class="text-3xl font-bold text-blue-600">{{ total_requests }}</div>
      <p class="text-xs text-gray-400 mt-2">All time submissions</p>
    </div>
    
    <div class="glass p-6 rounded-2xl shadow-sm border-l-4 border-yellow-500 hover:-translate-y-1 transition-transform">
      <div class="text-sm font-bold text-gray-500 uppercase mb-2">Pending</div>
      <div class="text-3xl font-bold text-yellow-600">{{ pending }}</div>
      <p class="text-xs text-gray-400 mt-2">Awaiting assignment</p>
    </div>
    
    <div class="glass p-6 rounded-2xl shadow-sm border-l-4 border-green-500 hover:-translate-y-1 transition-transform">
      <div class="text-sm font-bold text-gray-500 uppercase mb-2">Collected</div>
      <div class="text-3xl font-bold text-green-600">{{ collected }}</div>
      <p class="text-xs text-gray-400 mt-2">Items collected</p>
    </div>
    
    <div class="glass p-6 rounded-2xl shadow-sm border-l-4 border-purple-500 hover:-translate-y-1 transition-transform">
      <div class="text-sm font-bold text-gray-500 uppercase mb-2">Completion Rate</div>
      <div class="text-3xl font-bold text-purple-600">{{ completion_rate }}%</div>
      <p class="text-xs text-gray-400 mt-2">Collected vs total</p>
    </div>
  </div>

  <!-- Weight Analytics -->
  <div class="glass p-6 rounded-2xl shadow-sm mb-8 fade-in-up" style="animation-delay: 200ms;">
    <h2 class="text-2xl font-bold text-[#005461] mb-6">ğŸ“Š Material Composition</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
        <div class="text-4xl font-bold text-[#3BC1A8] mb-2">{{ total_weight }} <span class="text-lg">grams</span></div>
        <p class="text-gray-600">Total e-waste collected</p>
      </div>
      <div>
        <table class="w-full text-sm">
          <thead class="bg-white/40">
            <tr>
              <th class="px-3 py-2 text-left font-semibold">Material Type</th>
              <th class="px-3 py-2 text-center font-semibold">Count</th>
              <th class="px-3 py-2 text-center font-semibold">Weight (g)</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-100/50">
            {% for item in material_data[:5] %}
            <tr class="hover:bg-white/30">
              <td class="px-3 py-2">{{ item._id }}</td>
              <td class="px-3 py-2 text-center">{{ item.count }}</td>
              <td class="px-3 py-2 text-center">{{ item.total_weight }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Engineer Performance -->
  <div class="glass p-6 rounded-2xl shadow-sm mb-8 fade-in-up" style="animation-delay: 300ms;">
    <h2 class="text-2xl font-bold text-[#005461] mb-6">ğŸ‘· Engineer Performance</h2>
    <div class="overflow-x-auto">
      <table class="w-full text-sm">
        <thead class="bg-white/40">
          <tr>
            <th class="px-4 py-3 text-left font-semibold">Engineer</th>
            <th class="px-4 py-3 text-center font-semibold">Jobs Completed</th>
            <th class="px-4 py-3 text-center font-semibold">Status</th>
            <th class="px-4 py-3 text-center font-semibold">Available Tomorrow</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100/50">
          {% for eng in engineers %}
          <tr class="hover:bg-white/30">
            <td class="px-4 py-3 font-medium">{{ eng.name }}</td>
            <td class="px-4 py-3 text-center"><span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full">{{ eng.jobs_completed }}</span></td>
            <td class="px-4 py-3 text-center">
              <span class="px-3 py-1 rounded-full text-xs font-bold
                {% if eng.get('status') == 'On Route' %}bg-green-100 text-green-800{% else %}bg-gray-100 text-gray-800{% endif %}">
                {{ eng.get('status', 'Available') }}
              </span>
            </td>
            <td class="px-4 py-3 text-center">
              {% if eng.available %}
              <span class="text-green-600 font-bold">âœ“ Yes</span>
              {% else %}
              <span class="text-red-600 font-bold">âœ— No</span>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Recent Clusters -->
  <div class="glass p-6 rounded-2xl shadow-sm mb-8 fade-in-up" style="animation-delay: 400ms;">
    <h2 class="text-2xl font-bold text-[#005461] mb-6">ğŸš› Recent Collection Routes</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      {% for cluster in clusters[:6] %}
      <div class="border border-white/50 bg-white/30 rounded-xl p-4 hover:shadow-md transition">
        <div class="flex justify-between items-start mb-3">
          <div>
            <p class="font-bold text-gray-800 flex items-center gap-2">Route {{ cluster._id|string|truncate(6, True, '') }} <a href="{{ url_for('warehouse.view_route', cluster_id=cluster._id) }}" target="_blank" class="text-xs bg-blue-100 text-blue-600 px-2 py-0.5 rounded hover:bg-blue-200">ğŸ—ºï¸ Map</a></p>
            <p class="text-xs text-gray-500">{{ cluster.created_at.strftime('%d %b %Y %H:%M') if cluster.created_at else 'N/A' }}</p>
          </div>
          <span class="px-3 py-1 rounded-full text-xs font-bold
            {% if cluster.status == 'completed' %}bg-green-100 text-green-800
            {% elif cluster.status == 'in_progress' %}bg-blue-100 text-blue-800
            {% else %}bg-yellow-100 text-yellow-800{% endif %}">
            {{ cluster.status }}
          </span>
        </div>
        <div class="text-sm text-gray-600">
          <p>ğŸ“Š Items: {{ cluster.users|length }}</p>
          <p>âš–ï¸ Total: {{ cluster.total_weight|default('N/A') }} g</p>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- Recycler Summary -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8 fade-in-up" style="animation-delay: 500ms;">
    <div class="glass p-6 rounded-2xl shadow-sm">
      <h2 class="text-xl font-bold text-[#005461] mb-4">â™»ï¸ Recycling Progress</h2>
      <div class="space-y-2">
        <p class="text-lg"><span class="font-bold text-purple-600">{{ recycled_items }}</span> items recycled</p>
        <p class="text-lg"><span class="font-bold text-blue-600">{{ recyclers|length }}</span> recyclers available</p>
        <p class="text-sm text-gray-600 mt-4">Ready for final processing and material recovery</p>
      </div>
    </div>
    
    <div class="glass p-6 rounded-2xl shadow-sm">
      <h2 class="text-xl font-bold text-[#005461] mb-4">ğŸ“ˆ Daily Activity</h2>
      <div class="space-y-2">
        {% for day in daily_data_limited %}
        <div class="flex justify-between items-center">
          <span class="text-sm text-gray-600">{{ day._id }}</span>
          <span class="font-bold text-blue-600">{{ day.count }} requests</span>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
